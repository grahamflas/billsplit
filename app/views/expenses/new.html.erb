<div>
  <h1 class="font-bold text-4xl">New Expense</h1>

  <div class="flex flex-col bg-white shadow rounded-lg p-8 max-w-md">
    <%= form_with model: @expense, class: "flex flex-col gap-4" do |f| %>
      <%= render 'shared/error_messages', resource: f.object %>

      <div>
        <%= f.text_field :reference,
          autofocus: true,
          class: "border border-indigo-50 rounded-md bg-indigo-50 focus:outline-indigo-400 px-3 py-2 w-full"
        %>

        <%= f.label :reference, "Reference", class:"text-gray-500" %>
      </div>

      <div>
        <%= f.number_field :amount,
          autofocus: true,
          class: "border border-indigo-50 rounded-md bg-indigo-50 focus:outline-indigo-400 px-3 py-2 w-full"
        %>

        <%= f.label :amount, "Amount", class:"text-gray-500" %>
      </div>

      <% group = Group.where(id: params[:group_id]) %>

      <div>
        <%= f.label :group_id, "Group", class:"text-gray-500" %>

        <%= f.collection_select :group_id,
          group.any? ? group : current_user.groups,
          :id,
          :name,

          {
            selected: group.any? ? group.first : nil,
          },
          {
            class: "border border-indigo-50 rounded-md bg-indigo-50 #{group.present? ? "cursor-not-allowed" : "" } focus:outline-indigo-400 px-3 py-2 w-full",
          }
        %>
      </div>

      <div>
        <%= f.label :user_id, "User", class:"text-gray-500" %>

        <%= f.collection_select :user_id,
          group.any? ? group.first.users :
          User.
            joins(:groups).
            merge(current_user.groups).
            distinct,
          :id,
          :email,
          {},
          {
            class: "border border-indigo-50 rounded-md bg-indigo-50 focus:outline-indigo-400 px-3 py-2 w-full",
          }
        %>
      </div>

      <%= f.submit class: "w-full bg-indigo-500 hover:bg-indigo-600 focus:outline-indigo-900 rounded-md text-white py-2 mb-6 cursor:pointer" %>
    <% end %>
  </div>
</div>
